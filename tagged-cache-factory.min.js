!function(a,b){"function"==typeof define&&define.amd?define(["angular"],b):a.taggedCacheFactory=b(a.angular)}(this,function(a){"use strict";var b=a.module("tagged.services.cache-factory",[]);return b.factory("taggedCacheFactory",function(){var b=function(b,c){this._cacheId=b,this._cache={},this._head=null,this._tail=null,this._options=a.extend({capacity:!1},c||{})};b.prototype.get=function(a){if(!this._cache.hasOwnProperty(a))return void 0;var b=this._cache[a];if(b.expiration){var d=new Date;if(d.getTime()>b.expiration.getTime())return void this.remove(a)}return c.call(this,b),b.value},b.prototype.put=function(b,f,g,h){a.isArray(h)||(h=a.isString(h)?[h]:[]);var i={key:b,value:f,expiration:!1,tags:h};g=parseInt(g,10),isFinite(g)&&g>0&&(i.expiration=new Date((new Date).getTime()+g)),c.call(this,i),this._cache[b]=i;var j=Object.keys(this._cache).length;this._options.capacity>0&&j>this._options.capacity&&(e.call(this),Object.keys(this._cache).length>this._options.capacity&&d.call(this))};var c=function(a){this._head?(a.next=this._head,this._head.previous=a):a.next=null,a.previous=null,this._head=a,this._tail||(this._tail=a)},d=function(){if(this._head===this._tail)return void console.log("nothing to do, head === tail");var a=this._tail,b=a.previous;b.next=null,this._tail=b,delete this._cache[a.key]},e=function(){var b=new Date,c=this;a.forEach(this._cache,function(a,d){a.expiration&&b.getTime()>a.expiration.getTime()&&c.remove(d)})};b.prototype.remove=function(a){if(this._cache.hasOwnProperty(a)){var b=this._cache[a],c=b.previous,d=b.next;c&&(c.next=d),d&&(d.previous=c),this._tail===b&&(this._tail=c),delete this._cache[a]}},b.prototype.removeAll=function(){this._cache={},this._head=null,this._tail=null},b.prototype.removeMatchingTag=function(b){var c=this;a.forEach(this._cache,function(a,d){-1!==a.tags.indexOf(b)&&c.remove(d)})},b.prototype.destroy=function(){this.removeAll(),delete f[this._cacheId]};var f={},g=function(a,c){if(f.hasOwnProperty(a))throw"A cache by the ID '"+a+"' already exists.";var d=new b(a,c);return f[a]=d,d};return g.get=function(a){return f[a]},g.TaggedCache=b,g}),b});